#include "ui/screens/OtaUpdateScreen.h"
#include "driver/input/InputManager.h"
#include "bitmaps.h"
#include "ui/ColorPalette.h"
#include "core/EventBus.h"
#include <ArduinoOTA.h>

const unsigned char ota_icon[] PROGMEM = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x3f,0xff,0xff,0xc0,0x00,0x00,0x3f,0x00,0xc0,0x00,0x00,0x00,0x00,0x3f,0xff,0xff,0xc0,0x00,0x00,0x3f,0x00,0xc0,0x00,0x00,0x00,0x0f,0xc0,0x00,0x00,0x3f,0xc0,0x00,0x00,0xf0,0xc0,0x00,0x00,0x00,0x0f,0xc0,0x00,0x00,0x3f,0xc0,0x00,0x00,0xf0,0xc0,0x00,0x00,0x00,0xf0,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x0c,0x30,0x00,0x00,0x00,0xf0,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x0c,0x30,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x03,0xc0,0x0f,0x0c,0x30,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x03,0xc0,0x0f,0x0c,0x30,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0xc3,0x0c,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0xc3,0x0c,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0xc3,0x0c,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0xc3,0x0c,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x0c,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x0c,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x0c,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0xf0,0x0c,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0xf0,0x0c,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x0c,0x0c,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x0c,0x0c,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x03,0x03,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0x03,0x03,0x00,0x00,0x03,0x00,0x3c,0x00,0x00,0x00,0x00,0x03,0x03,0xc0,0xc3,0x00,0x00,0x03,0x00,0x3c,0x00,0x00,0x00,0x00,0x03,0x03,0xc0,0xc3,0x00,0x00,0x03,0x00,0xc3,0x00,0x03,0x00,0x00,0x03,0x0c,0x30,0xc3,0x00,0x00,0x03,0x00,0xc3,0x00,0x03,0x00,0x00,0x03,0x0c,0x30,0xc3,0x00,0x00,0x0c,0x03,0x00,0xc0,0x03,0x00,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x0c,0x03,0x00,0xc0,0x03,0x00,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x0c,0x0f,0x00,0xc0,0x00,0xc0,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x0c,0x0f,0x00,0xc0,0x00,0xc0,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x0c,0x0c,0x00,0xc0,0x00,0xc0,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x0c,0x0c,0x00,0xc0,0x00,0xc0,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x3c,0x0c,0x00,0x30,0x00,0x30,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x3c,0x0c,0x00,0x30,0x00,0x30,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x33,0x30,0x00,0x30,0x00,0x30,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x33,0x30,0x00,0x30,0x00,0x30,0x00,0x03,0x0c,0x30,0xc0,0xc0,0x00,0x3c,0xf0,0x00,0x30,0x00,0x0c,0x00,0x03,0x03,0xc0,0xc0,0xc0,0x00,0x3c,0xf0,0x00,0x30,0x00,0x0c,0x00,0x03,0x03,0xc0,0xc0,0xc0,0x00,0xf3,0xc0,0x00,0x3f,0x00,0x03,0x00,0x00,0xc0,0x03,0x00,0xc0,0x00,0xf3,0xc0,0x00,0x3f,0x00,0x03,0x00,0x00,0xc0,0x03,0x00,0xc0,0x00,0xcf,0x00,0x00,0x3f,0x00,0x00,0xc0,0x00,0x30,0x0c,0x00,0xc0,0x00,0xcf,0x00,0x00,0x3f,0x00,0x00,0xc0,0x00,0x30,0x0c,0x00,0xc0,0x00,0xfc,0x00,0x00,0x3f,0xc0,0x00,0x00,0x00,0x0f,0xf0,0x03,0xc0,0x00,0xfc,0x00,0x00,0x3f,0xc0,0x00,0x00,0x00,0x0f,0xf0,0x03,0xc0,0x00,0xf0,0x00,0x00,0xff,0xc0,0x00,0x00,0x00,0x00,0x00,0x0c,0xc0,0x00,0xf0,0x00,0x00,0xff,0xc0,0x00,0x00,0x00,0x00,0x00,0x0c,0xc0,0x00,0xc0,0x00,0x00,0xff,0xf0,0x00,0x00,0x00,0x00,0x00,0x33,0x00,0x00,0xc0,0x00,0x00,0xff,0xf0,0x00,0x00,0x00,0x00,0x00,0x33,0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xff,0xc0,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xff,0xc0,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xff,0xc0,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xff,0xc0,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x03,0xc0,0xff,0xff,0x00,0x00,0x00,0x00,0x3f,0x00,0x00,0x00,0x00,0x03,0xc0,0xff,0xff,0x00,0x00,0x00,0x00,0x3f,0x00,0x00,0x00,0x00,0x03,0x00,0x0f,0xf0,0x00,0x00,0xff,0xc0,0x3f,0x00,0x00,0x00,0x00,0x03,0x00,0x0f,0xf0,0x00,0x00,0xff,0xc0,0x3f,0x00,0x00,0x00,0x00,0x03,0xc0,0x00,0x00,0x00,0x3c,0x00,0x03,0x3c,0x00,0x00,0x00,0x00,0x03,0xc0,0x00,0x00,0x00,0x3c,0x00,0x03,0x3c,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0xcc,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0xcc,0x00,0x00,0x00,0x00,0x0c,0xc0,0x00,0x00,0x30,0x00,0x00,0x00,0xfc,0x00,0x00,0x00,0x00,0x0c,0xc0,0x00,0x00,0x30,0x00,0x00,0x00,0xfc,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x33,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x33,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0xcc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0xcc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0xf3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0xf3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0xcc,0x00,0x03,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x00,0x03,0xcc,0x00,0x03,0xc0,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x00,0x0f,0x30,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x00,0x0f,0x30,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x00,0x0c,0xcc,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x0c,0xcc,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x33,0x30,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x33,0x30,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0xcc,0xc0,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0xcc,0xc0,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0xf3,0x00,0x00,0x0c,0xc0,0x03,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0xf3,0x00,0x00,0x0c,0xc0,0x03,0x00,0x00,0x00,0x00,0x0c,0x00,0x03,0xcc,0x00,0x00,0x33,0x3c,0x00,0xf0,0x00,0x00,0x00,0x0c,0x00,0x03,0xcc,0x00,0x00,0x33,0x3c,0x00,0xf0,0x00,0x00,0x00,0x0c,0x00,0x0f,0x33,0x00,0x00,0x0c,0xcf,0xc0,0x0c,0x00,0x00,0x00,0x0c,0x00,0x0f,0x33,0x00,0x00,0x0c,0xcf,0xc0,0x0c,0x00,0x00,0x00,0x0c,0x00,0x0c,0xcc,0x00,0x00,0x03,0x33,0xf0,0x03,0xc0,0x00,0x00,0x0c,0x00,0x0c,0xcc,0x00,0x00,0x03,0x33,0xf0,0x03,0xc0,0x00,0x00,0x0c,0x00,0x33,0x30,0x00,0x00,0x00,0xcc,0xff,0x00,0x30,0x00,0x00,0x0c,0x00,0x33,0x30,0x00,0x00,0x00,0xcc,0xff,0x00,0x30,0x00,0x00,0x0c,0x00,0xcc,0xc0,0x00,0x00,0x00,0x33,0x3f,0xc0,0x0f,0xff,0xff,0xcc,0x00,0xcc,0xc0,0x00,0x00,0x00,0x33,0x3f,0xc0,0x0f,0xff,0xff,0xcc,0x00,0xf3,0x00,0x00,0x00,0x00,0x0c,0xcf,0xfc,0x00,0x00,0x00,0xf0,0x00,0xf3,0x00,0x00,0x00,0x00,0x0c,0xcf,0xfc,0x00,0x00,0x00,0xf0,0x00,0xc0,0x00,0x00,0x00,0x00,0x33,0x33,0xff,0xc0,0x00,0x00,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x33,0x33,0xff,0xc0,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcc,0xff,0xfc,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcc,0xff,0xfc,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x3f,0xff,0xff,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x3f,0xff,0xff,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xcc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xcc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x3f,0xc3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x3f,0xc3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xcc,0xc3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xcc,0xc3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0xc3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0xc3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x0};

OtaUpdateScreen::OtaUpdateScreen() {
    EventBus::instance().subscribe<ota_error_t>(
        EventType::OTA_UPDATE_FAILED,
        [&](const ota_error_t& err) {
            hasFailed = true;
            dirty();
        }
    );
}

void OtaUpdateScreen::draw()
{
    _ui->clear();
    _ui->withSurface(280, 240, 0, 0, [this](RenderSurface& s) {
        s.sprite->drawBitmap(0, 0, ota_icon, 102, 128, COLOR_TEXT_PRIMARY);
        if (hasFailed) s.text(0, 0, "Failed", TextSize::bxl, COLOR_ERROR);
    });
    //display.getTft()->setTextDatum(MC_DATUM);
    //display.drawText((display.getTFTWidth()/2) - 40, display.getTFTHeight() / 2 + 30, "Update l√§dt...", COLOR_TEXT_PRIMARY, 2);
}

void OtaUpdateScreen::update() {
}

void OtaUpdateScreen::handleInput(InputEvent event) {
}


